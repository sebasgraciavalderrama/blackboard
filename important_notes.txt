<?php

  if ($oldversion < 2018112000) {
        $params = ['topics','folderview','flexpage'];
        $DB->execute('UPDATE {course} SET format = ? WHERE format = ? OR format = ?', $params);
        // Mrooms savepoint reached.
        upgrade_plugin_savepoint(true, 2018111600, 'local', 'mrooms');
    }
    $DB->execute('UPDATE {course_format_options} SET format = ? WHERE format = ? OR format = ?', $params);
    $DB->execute('DELETE FROM{course_format_options} WHERE format = ? OR format = ?', $params);

/*
    EXPECTED BEHAVIOUR:

    The courses with the folowing formats: 'flexpage' and 'folderview' should have 'topics' now instead.
    No other course format should have folderview or flexpage as its value.
    1. Execute the upgrade
    2. You can navigate to master->Admin->Front page settings->Reports-> Admin SQL and run the following query (after executing the upgrade):
    SELECT * FROM mdl_course WHERE format='folderview' OR format='flexpage'
    The output should be: Nothing to display.
    3. Alternatively the following query can be executed and see the query results.
    SELECT * FROM mdl_course WHERE format='topics', no folderview or flexpage values should appear under the format column.
*/

PARA EJECUTAR EL UPGRADE DESDE CONSOLA (CAMBIOS HECHOS SOBRE upgrade.php)
    php admin/cli/upgrade.php

SI EL SERVIDOR DE SELENIUM MUESTRA PROBLEMAS
    behat-servers-start

INCIALIZAR BEHAT
    php admin/tool/behat/cli/init.php

Esto es para el ticket 13698 Behat tests
    vendor/bin/behat --config /srv/moodledata/behat_moodledata/behatrun/behat/behat.yml /vagrant/www/moodle/theme/snap/tests/behat/ajax_logout_msg.feature
    vendor/bin/behat --config /srv/moodledata/behat_moodledata/behatrun/behat/behat.yml /vagrant/www/moodle/theme/snap/tests/behat/assignment_grading_capabilities.feature
    vendor/bin/behat --config /srv/moodledata/behat_moodledata/behatrun/behat/behat.yml /vagrant/www/moodle/theme/snap/tests/behat/personal_menu_messages.feature
    vendor/bin/behat --config /srv/moodledata/behat_moodledata/behatrun/behat/behat.yml /vagrant/www/moodle/theme/snap/tests/behat/personalmenu_grades.feature
    vendor/bin/behat --config /srv/moodledata/behat_moodledata/behatrun/behat/behat.yml /vagrant/www/moodle/theme/snap/tests/behat/course_category_colors_setting.feature


PLD BEHAT TEST'S
    vendor/bin/behat --config /srv/moodledata/behat_moodledata/behatrun/behat/behat.yml /vagrant/www/moodle/local/pld/tests/behat/pld_enrol.feature
    vendor/bin/behat --config /srv/moodledata/behat_moodledata/behatrun/behat/behat.yml /vagrant/www/moodle/local/pld/tests/behat/pld_enrol_disable.feature

ALLY LTI BEHAT TEST'S (GUY PR COMMIT Logger)
    vendor/bin/behat --config /srv/moodledata/behat_moodledata/behatrun/behat/behat.yml /vagrant/www/moodle/report/allylti/tests/behat/view_report.feature


ERROR WHEN THE WEBSERVICE IS NOT DECLARED CORRECTLY
        Unknown error type: Class 'local_pld\webservice\external_api' not
        found at /vagrant/www/moodle/local/pld/classes/webservice/pld_search_courses.php: 39 (Exception)

XPATH
    And I click on "//a[@file='repo_upload_file']]" "xpath_element"
    //input[@type='file']

PARA QUITAR UN ARCHIVO DEL COMMIT
    git reset HEAD /path/to/file/file.xyz
    git status
    git commit -m "INT-123: Descripcion 123 abc xyz"

PARA SUBIR EL PHPUnit
    php admin/tool/phpunit/cli/init.php
    vendor/bin/phpunit path/to/file

PARA CORRER LA PRUEBA
    vendor/bin/phpunit path/to/file
    Ejemplo:
      vendor/bin/phpunit local/mrooms/tests/course_test.php
      vendor/bin/phpunit local/mrooms/tests/plugins_test.php

PARA IMPRIMIR EN REGUS
    regus.tierrafirme@regus.com

PARA HACER EL AMEND
    Agregar los archivos modificados:
      git add path/to/files
    git commit --amend
    (luego se hace el push forzado)
    git push -f origin nombre_branch

git push -f origin feature/INT-13902_superficial-rattlesnake
git push -f origin feature/INT-13698_substantial-newt
git push -f origin origin/update/INT-12776_juvenile-tortoise /** dont add oriing**/
git push -f origin update/INT-14160_acclaimed-cow
git push -f origin update/INT-14118_exhausted-gecko

PARA AGREGAR LOS MODIFICADOS Y NO LOS NUEVOS
    git add . -u

PARA MIRAR EL LOG DEL GIT
    git log

PARA CREAR UNA NUEVA BRANCH Y LUEGO HACER EL KOW PUSH ( EN EL CASO DE QUE NO EXISTA UNA BRANCH e.g: MR 3.5 MP 1 no existe)
    git checkout -b (feature or update)/INT-XXXXX_<NAME-OF-THE-BRANCH>
      git checkout -b update/INT-14022_heuristic-salamander
    kow push -p

PARA HACER EL GIT CHERRY-PICK
    git cherry-pick <commit-hash>
      estos hash de los commits estan en mroomstech dentro del pull request y toca hacerlo del mas viejo al ultimo
        'git show' y luego seleccionar el hash del commit que quiero seleccionar...

PARA REBASE
    git pull origin release/3.5+2 --rebase

VIDEO YOUTUBE PLD
    https://www.youtube.com/watch?v=YUvfziypPvs

CREATING CUSTOM ROLES
    https://docs.moodle.org/36/en/Creating_custom_roles

ARCHETYPES
    https://docs.moodle.org/dev/Role_archetypes

ACCESS API
    https://docs.moodle.org/dev/Access_API#How_to_define_new_capabilities_in_plugins

PLD VIDEO RESOURCES
    https://www.youtube.com/watch?v=YUvfziypPvs&
    https://www.youtube.com/watch?v=UWjbPQRyJcI

    001 Example: | clean | # /var/www/mrhosts/bamboo6/xml-data/build-dir/DEV-MOOD1176-BEH/local/geniusws/tests/behat/genius_sso.feature:157

    002 Example: | snap  | # /var/www/mrhosts/bamboo6/xml-data/build-dir/DEV-MOOD1176-BEH/local/geniusws/tests/behat/genius_sso.feature:158

vendor/bin/behat --config /srv/moodledata/behat_moodledata/behatrun/behat/behat.yml /vagrant/www/moodle/local/geniusws/tests/behat/genius_sso.feature

git commit -m "INT-12776: Added new steps to behat test and conditional operator"

BACKPORT VIDEO
    https://us.bbcollab.com/recording/40866604289a4ea88ece11bdd7874bc0


HOW TO DISABLE PLUGINS, BLOCKS, ETC
 In the file /www/moodle/config_local.php
 Uncomment the type of component you want to disable;
    If you want to disable a block then uncomment '$_MR_BLOCKS           = mr_all_plugins('blocks');'
 Then add this into a new line: 'unset($_MR_BLOCKS['collect']);'
 Then go to Site administration->Type into the search box 'control panel'->Select 'Control Panel'->And navigate to the type of $_MR_XXXX
 and you should see the component with the label 'Disabled' right next to it
 Purging caches might not be necessary but you could purge them any ways.

DEBUG WHATS INSIDE A VAR
    public static function login_url() {
        global $PAGE;
        fwrite(STDERR, 'PAGE URL set? ' . isset($PAGE->url) . PHP_EOL); //this line prints the error through terminal
        if (!PHPUNIT_TEST && isset($PAGE->url)) {
            fwrite(STDERR, 'PAGE URL: ' . $PAGE->url . PHP_EOL); //this line prints the error through terminal
            $url = $PAGE->url;
        } else {
            $url = null;
        }
        return new \moodle_url('/local/geniusws/login.php', ['referrer' => $url]);
    }

USING $CFG TO DESCRIBE A CONTEXT
    $CFG->dirroot/local/pld/classes/form/formattedcourse.php

IN config_kow.php YOU CAN FIND THE CURRENT DATABASE NAME
    i.e. $CFG->dbname = 'INT12344'

HOW TO GET CONTEXT
    https://docs.moodle.org/dev/Access_API#Context_fetching

HOW TO SAVE YOUR TERMINAL OUTPUT TO A FILE
    script (type this into your terminal and it will start recording)

HOW TO EXTRACT FILES
    Type man tar for more information, but this command should do the trick:

    tar -xvzf community_images.tar.gz
    To explain a little further, tar collected all the files into one package, community_images.tar. The gzip program applied compression, hence the gz extension. So the command does a couple things:

    f: this must be the last flag of the command, and the tar file must be immediately after. It tells tar the name and path of the compressed file.
    z: tells tar to decompress the archive using gzip
    x: tar can collect files or extract them. x does the latter.
    v: makes tar talk a lot. Verbose output shows you all the files being extracted.

HOW TO CHANGE THE EXTENSION OF A FILE
    mv your_file.extension your_file.new.extension

HOW TO MOVE FILES TO ANOTHER FOLDER
    mv your_file.extension new/path/

STACK TRACE OF BEHAT ERROR WHEN THE PLD WEBSERVICE IS NOT CALLED CORRECTLY
    Error code: generalexceptionmessage
    * line 228 of /local/pld/classes/webservice/pld_search_courses.php: Error thrown
    * line 101 of /local/pld/classes/webservice/pld_search_courses.php: call to local_pld\webservice\pld_search_courses::search_courses()
    * line 228 of /lib/externallib.php: call to local_pld\webservice\pld_search_courses::local_pld_search_courses()
    * line 59 of /lib/ajax/service.php: call to external_api::call_external_function()


SET GOALS - BLACKBOARD
    https://onblackboard.sharepoint.com/sites/HR/PerformanceManagement/Pages/Goals-Management-for-Employees.aspx

#----------------GUYS ALLY LOGGER PR - Psr logger #19------------------------#

kow accept https://github.com/blackboard-open-source/moodle-filter_ally/pull/12 filter/ally

vendor/bin/phpunit --colors "local_geniusws_server_service_test" local/geniusws/tests/server/service_test.php

revert

commit c5d1a1108943df8cb0186cef975b1e273667edd8 (origin/update/INT-14160_dreary-magpie, update/INT-14160_dreary-magpie)
Author: Sebastian Gracia <sebastian.graciavalderrama@blackboard.com>
Date:   Thu Feb 21 12:28:50 2019 -0500

    INT-14160: Array context deleted

commit 1a624bed15d824774bbc8f7aedd24ae44fddeb35 (origin/update/INT-14160_acclaimed-cow, update/INT-14160_acclaimed-cow)
Author: Sebastian Gracia <sebastian.graciavalderrama@blackboard.com>
Date:   Fri Feb 15 15:49:04 2019 -0500

    INT-14160: Node module deleted

kow accept https://github.com/blackboard-open-source/moodle-tool_ally/pull/23 admin/tool/ally
#----------------------------------------------------------------------------#

HOW TO GRUNT FILES
    Desde '/Users/sebastiangracia/vagrant/www/moodle' ejecutar este comando:
        grunt uglify:amd --force

HOW TO DELETE MODIFIED FILES FROM git status (i.e. When you execute a grunt command from moodle and it creates 400+ min.js files)
    git reset --hard *DO THIS AFTER ADDING (git add path/to/file.myfile) THE FILES YOU WANT TO COMMIT*